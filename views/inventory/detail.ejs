<h1><%= title %></h1>

<% if (notice && notice.length) { %>
  <div class="notice" role="status">
    <p><%= notice[0] %></p>
  </div>
<% } %>

<%- vehicleHTML %>

<section class="favorite-section">
  <h2>Save This Vehicle</h2>
  <% if (locals.loggedin) { %>
    <% if (isFavorited) { %>
      <form action="/favorite/remove" method="post" class="favorite-form">
        <input type="hidden" name="inv_id" value="<%= inv_id %>">
        <input type="hidden" name="return_to" value="/inv/detail/<%= inv_id %>">
        <button type="submit" class="btn-favorite btn-favorite-remove">Remove from Favorites</button>
      </form>
    <% } else { %>
      <form action="/favorite/add" method="post" class="favorite-form">
        <input type="hidden" name="inv_id" value="<%= inv_id %>">
        <input type="hidden" name="return_to" value="/inv/detail/<%= inv_id %>">
        <button type="submit" class="btn-favorite">Add to Favorites</button>
      </form>
    <% } %>
  <% } else { %>
    <p class="login-prompt">
      <a href="/account/login">Log in</a> to save this vehicle to your favorites.
    </p>
  <% } %>
</section>

<section class="reviews-section">
  <h2>Customer Reviews</h2>
  
  <% if (locals.loggedin) { %>
    <div class="review-form-container">
      <h3>Write a Review</h3>
      <form action="/review/add" method="post" class="review-form">
        <input type="hidden" name="inv_id" value="<%= inv_id %>">
        <label for="review_text">Your Review:</label>
        <textarea 
          name="review_text" 
          id="review_text" 
          rows="4" 
          required 
          minlength="10" 
          maxlength="1000"
          placeholder="Share your thoughts about this vehicle (minimum 10 characters)..."
        ></textarea>
        <button type="submit" class="btn-submit">Submit Review</button>
      </form>
    </div>
  <% } else { %>
    <p class="login-prompt">
      <a href="/account/login">Log in</a> to write a review.
    </p>
  <% } %>
  
  <div class="reviews-list">
    <% if (reviews && reviews.length > 0) { %>
      <% reviews.forEach(function(review) { %>
        <div class="review-item">
          <div class="review-header">
            <span class="review-author">
              <%= review.account_firstname.charAt(0) %><%= review.account_lastname %>
            </span>
            <span class="review-date">
              <%= new Date(review.review_date).toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
              }) %>
            </span>
          </div>
          <p class="review-text"><%= review.review_text %></p>
        </div>
      <% }) %>
    <% } else { %>
      <p class="no-reviews">No reviews yet. Be the first to review this vehicle!</p>
    <% } %>
  </div>
</section>
